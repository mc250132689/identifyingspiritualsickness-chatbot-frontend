<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ðŸ“Š Feedback Analysis</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="container">
<h2>Feedback Analysis</h2>
<p>Total Submissions: <strong id="total-feedback">0</strong></p>
<p>Average Rating: <strong id="average-rating">0</strong></p>
<button onclick="exportCSV()">Export CSV</button>
<canvas id="ratingChart" height="80"></canvas>
<canvas id="sentimentChart" height="80"></canvas>
<div id="word-frequency"></div>
<table id="feedback-table"><thead></thead><tbody></tbody></table>
</div>

<script>
const FEEDBACK_URL = "https://identifyingspiritualsickness-chatbot.onrender.com/get-feedback";

async function loadFeedback() {
  const res = await fetch(FEEDBACK_URL);
  const feedback = await res.json();
  document.getElementById("total-feedback").textContent = feedback.length;
  const tbody = document.querySelector("#feedback-table tbody");
  tbody.innerHTML = "";
  feedback.forEach((f,i)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${i+1}</td><td>${f.name||"-"}</td><td>${f.student_id||"-"}</td><td>${f.program||"-"}</td><td>${f.q14||"-"}</td>`;
    tbody.appendChild(tr);
  });
  window.feedbackData = feedback;
}

function exportCSV(){
  if(!window.feedbackData?.length) return alert("No feedback to export.");
  const csv = window.feedbackData.map(f=>[f.name,f.student_id,f.program,f.q14].join(",")).join("\n");
  const blob = new Blob([csv],{type:"text/csv"});
  const link = document.createElement("a"); link.href = URL.createObjectURL(blob);
  link.download = "feedback.csv"; link.click();
}

loadFeedback();
setInterval(loadFeedback,10000);
</script>
</body>
</html>
